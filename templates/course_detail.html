{% extends "base.html" %}

{% block content %}
<section style="padding: 2rem 5%;">
    <div style="margin-bottom: 2rem;">
        <a href="{{ url_for('dashboard') }}" style="color: var(--primary-color); text-decoration: none;">← بازگشت به
            داشبورد</a>
    </div>

    <h2 style="color: var(--primary-color); margin-bottom: 1rem;">{{ course.title }}</h2>
    <p style="color: var(--text-light); font-size: 1.1rem; margin-bottom: 3rem;">{{ course.description }}</p>

    <!-- Progress Overview -->
    <div
        style="background: white; padding: 2rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 3rem;">
        <h3 style="margin-bottom: 1rem;">پیشرفت شما</h3>
        {% set completed_count = progress|selectattr('completed', 'equalto', 1)|list|length %}
        <div style="background: #eee; height: 20px; border-radius: 10px; overflow: hidden; margin-bottom: 1rem;">
            <div
                style="background: var(--accent-color); height: 100%; width: {{ (completed_count / course.total_modules * 100)|int }}%;">
            </div>
        </div>
        <p style="color: var(--text-light);">{{ completed_count }} از {{ course.total_modules }} ماژول تکمیل شده ({{
            (completed_count / course.total_modules * 100)|int }}%)</p>
    </div>

    <!-- Modules List -->
    <h3 style="margin-bottom: 1.5rem;">ماژول‌های دوره</h3>
    <div style="display: flex; flex-direction: column; gap: 1rem;">
        {% for module in progress %}
        <div
            style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center;">
            <div style="flex: 1;">
                <h4 style="margin-bottom: 0.5rem;">ماژول {{ module.module_number }}</h4>
                {% if module.completed %}
                <p style="color: #28a745; font-weight: bold;">✓ تکمیل شده</p>
                {% if module.completed_at %}
                <p style="color: var(--text-light); font-size: 0.9rem;">تاریخ تکمیل: {{ module.completed_at[:10] }}</p>
                {% endif %}
                {% else %}
                <p style="color: var(--text-light);">در حال یادگیری...</p>
                {% endif %}
            </div>
            <div>
                {% if module.completed %}
                <form method="POST"
                    action="{{ url_for('uncomplete_module', course_id=course.id, module_num=module.module_number) }}"
                    style="display: inline;">
                    <button type="submit"
                        style="padding: 0.5rem 1rem; background: #ffc107; color: #000; border: none; border-radius: 4px; cursor: pointer;">علامت‌گذاری
                        به عنوان ناتمام</button>
                </form>
                {% else %}
                <form method="POST"
                    action="{{ url_for('complete_module', course_id=course.id, module_num=module.module_number) }}"
                    style="display: inline;">
                    <button type="submit"
                        style="padding: 0.5rem 1rem; background: var(--accent-color); color: #000; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">علامت‌گذاری
                        به عنوان تکمیل شده</button>
                </form>
                {% endif %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}